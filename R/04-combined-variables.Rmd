# Quality of Life Associations
Up to now we have explored how each quality of life indicator is associated with income inequality. It is equally important to disect how the quality of life indicators interplay with eachother.

```{r}
fig<-data.melt.avg %>% dplyr::mutate_if(is.numeric, round, 2)%>%
  plotly::plot_ly(
             x=~education_discrepancy_avg,y=~babies_per_woman_avg,z=~suicide_avg,
             color=~continent,colors=region.color,alpha=.8,
             text=~country,
             hovertemplate=paste('%{x}','%{text}','GINI:%{y}','SR:%{z}',sep='<br>'))
fig <- fig %>% plotly::add_markers()
fig <- fig %>% plotly::layout(scene = list(xaxis = list(title = 'Education Discrepancy'),
                     yaxis = list(title = 'Babies per Woman'),
                     zaxis = list(title = 'Suicide Rate')))
fig <- fig %>% plotly::layout(title="Suicide Rate by GINI Index", showlegend = T)
fig
```

Figure \@ref(fig:violinplots) illustrates the distribution of each indicator by region. The colored-polygons represent the density for a given value. The box and whisker plot within each colored-polygon depicts the non-outlier quartile values. Note the different axes scales for each indicator.

```{r violinplots, fig.cap="Inequality to Quality of Life", echo=FALSE}
data.melt.comb <- data.melt %>% 
  dplyr::select(continent, gini, education_discrepancy, babies_per_woman, suicide) %>%
  reshape2::melt(id="continent")
  
plot.violin(data.melt.comb, highcharter::highchart(), "value", "continent", "variable", highcharter::data_to_boxplot(data.melt.comb, value, continent, variable), c(1, 0, 2, 3)) %>%
    highcharter::hc_yAxis_multiples(
      list(title = list(text = "Education Discrepancy"), maxRange=1),
      list(title = list(text = "Gini Coeficient")),
      list(title = list(text = "Babies"), opposite=T),
      list(title = list(text = "Suicide"), opposite=T))
```

```{r lineplots, fig.cap="Quality of Life over Time", echo = FALSE}
data <- data.melt.yearly

fig.education <- data %>%
  plotly::group_by(continent) %>%
  plotly::plot_ly(x = ~year, color = ~continent, 
                  # colors = region.color, 
                  colors = c('#E41A1C', '#377EB8', '#4DAF4A', '#984EA3', "#FF7F00", "#FFFF33", "#A65628"),
                  legendgroup = ~continent, 
                  hovertext = paste("Education Discrepancy: ", data$education_discrepancy_avg, 
                                    "<br>Year: ", data$year, 
                                    "<br>Continent: ", data$continent),
                  hoverinfo = "text") %>%
  plotly::add_lines(y = ~education_discrepancy_avg, showlegend = FALSE) %>%
  plotly::layout(xaxis = list(title = "Year"), yaxis = list(title = "Education Discrepancy"))

fig.suicide <- data %>%
  plotly::group_by(continent) %>%
  plotly::plot_ly(x = ~year, color = ~continent, 
                  # colors = region.color,
                  colors = c('#E41A1C', '#377EB8', '#4DAF4A', '#984EA3', "#FF7F00", "#FFFF33", "#A65628"),                  
                  legendgroup = ~continent, 
                  hovertext = paste("Suicide: ", data$suicide_avg, 
                                    "<br>Year: ", data$year, 
                                    "<br>Continent: ", data$continent),
                  hoverinfo = "text") %>%
  plotly::add_lines(y = ~suicide_avg) %>%
  plotly::layout(xaxis = list(title = "Year"), yaxis = list(title = "Suicide"))

fig.babies <- data %>%
  plotly::group_by(continent) %>%
  plotly::plot_ly(x = ~year, color = ~continent, 
                  # colors = region.color,
                  colors = c('#E41A1C', '#377EB8', '#4DAF4A', '#984EA3', "#FF7F00", "#FFFF33", "#A65628"), 
                  legendgroup = ~continent, 
                  hovertext = paste("Babies: ", data$babies_per_woman_avg, 
                                    "<br>Year: ", data$year, 
                                    "<br>Continent: ", data$continent),
                  hoverinfo = "text") %>%
  plotly::add_lines(y = ~babies_per_woman_avg, showlegend = FALSE) %>%
  plotly::layout(xaxis = list(title = "Year"), yaxis = list(title = "Babies Per Woman"))

fig.gini <- data %>%
  plotly::group_by(continent) %>%
  plotly::plot_ly(x = ~year, color = ~continent, 
                  # colors = region.color,
                  colors = c('#E41A1C', '#377EB8', '#4DAF4A', '#984EA3', "#FF7F00", "#FFFF33", "#A65628"),                  
                  legendgroup = ~continent, 
                  hovertext = paste("Gini Coefficient: ", data$gini_avg, 
                                    "<br>Year: ", data$year, 
                                    "<br>Continent: ", data$continent),
                  hoverinfo = "text") %>%
  plotly::add_lines(y = ~gini_avg, showlegend = FALSE) %>%
  plotly::layout(xaxis = list(title = "Year"), yaxis = list(title = "Gini Coefficient")) 

fig <- plotly::subplot(fig.education, fig.suicide, fig.babies, fig.gini, nrows=2, titleY = TRUE, margin = c(0.085,0.075,0.1,0.1)) %>% plotly::layout(title = "Quality of Life over Time")

fig
```



