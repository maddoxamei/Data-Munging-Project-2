---
output: html_document
editor_options: 
  chunk_output_type: console
---
# sdf

```{r}
library (dplyr)
library (ggplot2)
library (countrycode)
library (tidyverse)
library (ggpubr)
library (magrittr)
library (ggridges)
library (viridis)
```

## Distribution of birth rates by continent
```{r}
ggplot(drop_na(data.melt.avg), 
       aes(x = babies_per_woman_avg, y = fct_rev(as_factor(continent)), fill = ..x..)) +
  geom_density_ridges_gradient(scale = 3, rel_min_height = 0.01) + 
  scale_fill_viridis(name = "Babies [count]", option = "H", direction = 1, alpha = 0.6) + 
  xlab("Babies per woman") + 
  ylab("") +
  ggtitle("Distribution of babies per woman") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```

## Distribution of birth rates compared to gini coefficient by continent
```{r}
require(gridExtra)
plot1 <- ggplot(drop_na(data.melt.avg), 
       aes(x = babies_per_woman_avg, y = fct_rev(as_factor(continent)), fill = ..x..)) +
  geom_density_ridges_gradient(scale = 3, rel_min_height = 0.01) + 
  scale_fill_viridis(name = "Babies [count]", option = "H", direction = 1, alpha = 0.6) + 
  xlab("Babies per woman") + 
  ylab("") +
  ggtitle("Distribution of babies per woman") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

plot2 <- ggplot(drop_na(data.melt.avg), 
       aes(x = gini_avg, y = fct_rev(as_factor(continent)), fill = ..x..)) +
  geom_density_ridges_gradient(scale = 3, rel_min_height = 0.01) + 
  scale_fill_viridis(name = "Gini Coefficient", option = "H", direction = 1, alpha = 0.6) + 
  xlab("Gini coefficient") + 
  ylab("") +
  ggtitle("Distribution of gini coefficient") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

ggarrange(plot1, plot2, ncol=1, nrow=2, legend="right")
```


## Scatter plots of birth rates by country
We're interested in investigating how birth rates are associated with income inequality (as measured by the gini coefficient).

A scatter plot demonstrating the relationship between birth rates and income inequality. Each point represents a unique country. The size of the point represents the average income per person and the color corresponds to the continent the country is affiliated with. 

```{r}
g <- ggplot(drop_na(data.melt.avg), 
            aes(x = babies_per_woman_avg, y = gini_avg, col = continent,  size = income_avg)) + 
  geom_point(alpha = 0.7) + xlab("Babies per woman") + 
  ylab("Gini coefficient") +
  ggtitle("Gini coefficient vs. babies per woman") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5)) 
#+ geom_smooth(method = lm, aes(group =1, colour = "black"))
plot(g)
```



The plot demonstrates a positive association between babies per woman and income inequality. In other words, countries with a higher number of babies per women are those that have higher average ginicoefficients. That said, we notice a similar association between babies per women use and average income per person. So it is unclear which of the variables (income or income inequality) may explain this trend. 

Aggregate by year
```{r}
# for lineplots comparing trends across all variables
data.avg.yearly <- data.melt %>% 
  dplyr::group_by(year, continent) %>% 
  dplyr::summarise_each(list(avg = ~mean(.x, na.rm=TRUE))) %>% 
  dplyr::select(-c("hc.a2_avg", "subregion_avg", "country_avg")) %>% 
  dplyr::filter(continent %in% c("Africa", "Asia", "Europe", "North America", "South America"))
```

```{r}
# plot of all 3-4 variables over time

require(gridExtra)
plot1 <- ggplot(drop_na(data.avg.yearly), aes(x=year, col = continent)) +
  geom_line(aes(y=suicide_avg)) + ylab("suicide rate") 
plot2 <- ggplot(drop_na(data.avg.yearly), aes(x=year, col = continent)) +
  geom_line(aes(y=babies_per_woman_avg)) + ylab("babies per woman") 
plot3 <- ggplot(drop_na(data.avg.yearly), aes(x=year, col = continent)) +
  geom_line(aes(y=education_discrepancy_avg)) + ylab("Education inequality") 
plot4 <- ggplot(drop_na(data.avg.yearly), aes(x=year, col = continent)) +
  geom_line(aes(y=gini_avg)) + ylab("Gini coefficient") 

plot <- ggarrange(plot1, plot2, plot3, plot4, ncol=4, nrow=1, common.legend = TRUE, legend="bottom")

annotate_figure(plot, top = text_grob("Variables of interest over time",
               color = "black", size = 14))
```

All variables across time (only considering Africa, Asia, and Europe) to emphasize trends
```{r}
# plot of all 3-4 variables over time, focusing on only three continents
require(gridExtra)
data <- data.avg.yearly %>% filter(continent %in% c("Africa", "Europe", "Asia"))

plot1 <- ggplot(drop_na(data), aes(x=year, col = continent)) +
  geom_line(aes(y=suicide_avg)) + ylab("suicide rate") 
plot2 <- ggplot(drop_na(data), aes(x=year, col = continent)) +
  geom_line(aes(y=babies_per_woman_avg)) + ylab("babies per woman") 
plot3 <- ggplot(drop_na(data), aes(x=year, col = continent)) +
  geom_line(aes(y=education_discrepancy_avg)) + ylab("Education inequality") 
plot4 <- ggplot(drop_na(data), aes(x=year, col = continent)) +
  geom_line(aes(y=gini_avg)) + ylab("Gini coefficient") 

plot_new <- ggarrange(plot1, plot2,plot3, plot4, ncol=4, nrow=1, common.legend = TRUE, legend="bottom")

annotate_figure(plot_new, top = text_grob("Variables of interest over time",
               color = "black", size = 14))
```





