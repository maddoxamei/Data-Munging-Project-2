---
output: html_document
editor_options: 
  chunk_output_type: console
---
# Income Inequality to Quality of Life

In this section, we focus on how each quality of life variable is associated with income inequality. 

## Education
Academic education is thought to be correlated with job opportunity, and by extension potentially higher income. Primary education in particular occurs during a critical time in individuals lives. For some, this early education is more-so a luxury than a necessity. We therefore considered primary school completion rate as an indicator for quality of life and potential income inequality factor.

Figure \@ref(fig:educationgini) illustrates said relationship. Primary school completion is measured as the ratio of new entrants to all age-relevant individuals for the last grade of primary school. This quantification method fails to account for individuals who dropout in the final year of primary education. As inequality is an overarching theme of interest to us, we focused on the primary school completion rate for boys compared to their girl counterparts - dubbed, "Eucation discrepancy."

```{r educationgini, fig.cap="Income Inequality to Education Inequality", echo=FALSE}
highcharter::hchart(data.melt.avg, "point",
          highcharter::hcaes(education_discrepancy_avg, gini_avg, z=income_avg, group = continent)) %>% 
  highcharter::hc_colors(region.color)%>% 
  highcharter::hc_plotOptions(bubble=list(minSize="1%",maxSize="10%")) %>% highcharter::hc_tooltip(
      pointFormat = "<b>{point.country}</b>
          <br/>{series.xAxis.axisTitle.textStr}: {point.x}
          <br/>{series.yAxis.axisTitle.textStr}: {point.y}
          <br/>Relevant Age Group: {point.education_avg}
          <br/>Boys: {point.education_boys_avg}
          <br/>Girls: {point.education_girls_avg}
          <br/>Income: {point.z}") %>%
  hc.label("Education Discrepancy", "Gini Coefficient", "Education to Income Inequality")
```

## Birth Rate

Education inequality and birth rate appeared to be positively correlated in the heatmap shown in the intro section. However, before studying the relationship between those two variables, we first focused on identifying any associations between birth rate and income inequality.  

In the scatter plot below:  

  * each point represents a country,  
  * the color of each point represents the corresponding continent,  
  * the x-axis represents the birth rate in babies per woman, and   
  * the y-axis represents income inequality via the Gini coefficient.   

Given the knowledge that low income populations tend to have higher birth rates than high income populations, we also used the size of each point to condition on income within each country.  

> ![sticky-note with remember written on it](https://cdn.pixabay.com/photo/2016/12/21/05/44/reminder-1922255_1280.png){width=10%}
> All plots are interactive. In the scatter plot below, you can select and deselect components in the plot. Double-clicking on a color in the legend will display only the points of that color, while single-clicking on a color in the legend will add or remove the corresponding points.

```{r birthrategini, fig.cap="Income Inequality to Birth Rate", echo = FALSE}
g <- ggplot2::ggplot(tidyr::drop_na(data.melt.avg), 
            ggplot2::aes(x = babies_per_woman_avg, y = gini_avg, col = continent,  size = income_avg)) + 
  ggplot2::geom_point(alpha = 0.7) + ggplot2::xlab("Babies Per Woman") + 
  ggplot2::ylab("Gini Coefficient") +
  ggplot2::ggtitle("Birth Rate to Income Inequality") + 
  ggplot2::theme_bw() + 
  ggplot2::theme(plot.title = ggplot2::element_text(hjust = 0.5)) + 
  ggplot2::scale_color_manual(values = region.color)

plotly::ggplotly(g)
```

The scatter plot confirms that there exists a positive correlation between birth rate and income inequality, on average. However, it reveals a few pieces of information that complicated our interpretation: 

1. The positive association between birth rate and income inequality does not necessarily hold across a single continent. When we isolate countries from only Africa or only Asia, we observe a negative association (i.e. a higher birth rate tends to be associated with lower income inequality).  
2. The distribution of the points in the plot are clustered by continent.   
3. The countries with low birth rates tend to have higher incomes than those with high birth rates. 

Thus, while there is an overall positive association between birth rate and income inequality, points 1 and 2 indicate that cultural and continent-wide variations are present. Likewise, point 3 indicates that income is a potential confounding variable that could be driving the initial trend we observed between birth rate and income inequality. 

## Suicide Rate
```{r suicidegini, fig.cap="Income Inequality to Suicide Rate", echo = FALSE}
fig<- data.melt.avg %>% dplyr::mutate_if(is.numeric, round, 2) %>% #For hovertemplate readability.
  plotly::plot_ly(
             x=~continent,y=~gini_avg,z=~suicide_avg,
             color=~continent,colors=region.color,alpha=.8,
             text=~country,
             hovertemplate=paste('%{x}','%{text}','GINI:%{y}','SR:%{z}',sep='<br>'))
fig <- fig %>% plotly::add_markers()
fig <- fig %>% plotly::layout(scene = list(xaxis = list(title = ''),
                     yaxis = list(title = 'gini index'),
                     zaxis = list(title = 'Suicide Rate')))
fig <- fig %>% plotly::layout(title="Suicide Rate by GINI Index", showlegend = FALSE)
fig
```
