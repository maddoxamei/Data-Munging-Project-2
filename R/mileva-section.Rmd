---
output: html_document
editor_options: 
  chunk_output_type: console
---
# Birth Rate

Distribution of birth rates by continent
```{r birthrate, fig.cap="Distribution of Birth Rates by Continent", echo = FALSE}
ggplot(drop_na(data.melt.avg), 
       aes(x = babies_per_woman_avg, y = fct_rev(as.factor(continent)), fill = ..x..)) +
  geom_density_ridges_gradient(scale = 3, rel_min_height = 0.01) + 
  scale_fill_gradient2(low = "blue", high = "red") +
  xlab("Babies per woman") +
  ylab("") +
  ggtitle("Distribution of babies per woman") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))
```

Scatter plots of birth rates by country
```{r birthrategini, fig.cap="Income Inequality to Birth Rate", echo = FALSE}
g <- ggplot(drop_na(data.melt.avg), 
            aes(x = babies_per_woman_avg, y = gini_avg, col = continent,  size = income_avg)) + 
  geom_point(alpha = 0.7) + xlab("Babies per woman") + 
  ylab("Gini coefficient") +
  ggtitle("Gini coefficient vs. babies per woman") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5)) 

ggplotly(g)
```



# Quality of Life 
Aggregate by year
```{r}
# for lineplots comparing trends across all variables
data.avg.yearly <- data.melt %>% 
  dplyr::group_by(year, continent) %>% 
  dplyr::summarise_each(list(avg = ~mean(.x, na.rm=TRUE))) %>% 
  dplyr::select(-c("hc.a2_avg", "subregion_avg", "country_avg")) %>% 
  dplyr::filter(continent %in% c("Africa", "Asia", "Europe", "North America", "South America"))
```

```{r lineplotsSubset, fig.cap = "Inequality to Quality of Life (subset)", echo = FALSE}

require(gridExtra)
plot1 <- ggplot(drop_na(data.avg.yearly), aes(x=year, col = continent)) +
  geom_line(aes(y=suicide_avg)) + ylab("suicide rate") 
plot2 <- ggplot(drop_na(data.avg.yearly), aes(x=year, col = continent)) +
  geom_line(aes(y=babies_per_woman_avg)) + ylab("babies per woman") 
plot3 <- ggplot(drop_na(data.avg.yearly), aes(x=year, col = continent)) +
  geom_line(aes(y=education_discrepancy_avg)) + ylab("Education inequality") 
plot4 <- ggplot(drop_na(data.avg.yearly), aes(x=year, col = continent)) +
  geom_line(aes(y=gini_avg)) + ylab("Gini coefficient") 

plot <- ggarrange(plot1, plot2, plot3, plot4, ncol=4, nrow=1, common.legend = TRUE, legend="bottom")

annotate_figure(plot, top = text_grob("Variables of interest over time",
               color = "black", size = 14))

```

```{r lineplots, fig.cap = "Inequality to Quality of Life", echo = FALSE}
require(gridExtra)
data <- data.avg.yearly %>% filter(continent %in% c("Africa", "Europe", "Asia"))

plot1 <- ggplot(drop_na(data), aes(x=year, col = continent)) +
  geom_line(aes(y=suicide_avg)) + ylab("suicide rate") 
plot2 <- ggplot(drop_na(data), aes(x=year, col = continent)) +
  geom_line(aes(y=babies_per_woman_avg)) + ylab("babies per woman") 
plot3 <- ggplot(drop_na(data), aes(x=year, col = continent)) +
  geom_line(aes(y=education_discrepancy_avg)) + ylab("Education inequality") 
plot4 <- ggplot(drop_na(data), aes(x=year, col = continent)) +
  geom_line(aes(y=gini_avg)) + ylab("Gini coefficient") 

plot_new <- ggarrange(plot1, plot2,plot3, plot4, ncol=4, nrow=1, common.legend = TRUE, legend="bottom")

annotate_figure(plot_new, top = text_grob("Variables of interest over time",
               color = "black", size = 14))
```
